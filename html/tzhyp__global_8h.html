<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>tzhyp_global.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_6aeebb853ebd8c514e6186653c592c82.html">otzone</a></li><li class="navelem"><a class="el" href="dir_fb44076c8b62c63869cf8a830933e50d.html">src</a></li><li class="navelem"><a class="el" href="dir_5054d892aa124e015c653e8232659643.html">arch</a></li><li class="navelem"><a class="el" href="dir_a8ff73de53c273984b8a08f3bd00cae5.html">arm</a></li><li class="navelem"><a class="el" href="dir_0f6da8a9c5259cd162214505231682b4.html">armv7</a></li><li class="navelem"><a class="el" href="dir_314c54530644a99bb6b146f499079a5e.html">include</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">tzhyp_global.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="sw__types_8h_source.html">sw_types.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="system__context_8h_source.html">system_context.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="tzhyp__config_8h_source.html">tzhyp_config.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="nsk__boot_8h_source.html">nsk_boot.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="sw__board_8h_source.html">sw_board.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="sw__mcore_8h_source.html">sw_mcore.h</a>&gt;</code><br/>
</div>
<p><a href="tzhyp__global_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a066643f2506655454be4342f325fc557"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tzhyp__global_8h.html#a066643f2506655454be4342f325fc557">tzhyp_guest_init</a> (void)</td></tr>
<tr class="memdesc:a066643f2506655454be4342f325fc557"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize guests.  <a href="#a066643f2506655454be4342f325fc557">More...</a><br/></td></tr>
<tr class="separator:a066643f2506655454be4342f325fc557"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4591534998b0845f3bd6f56f2851616b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tzhyp__global_8h.html#a4591534998b0845f3bd6f56f2851616b">tzhyp_schedevent_init</a> (void)</td></tr>
<tr class="memdesc:a4591534998b0845f3bd6f56f2851616b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Trustzone hypervisor schedule event initialization.  <a href="#a4591534998b0845f3bd6f56f2851616b">More...</a><br/></td></tr>
<tr class="separator:a4591534998b0845f3bd6f56f2851616b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7fc2dc4ad4fef314bf988d672c64a65d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tzhyp__global_8h.html#a7fc2dc4ad4fef314bf988d672c64a65d">tzhyp_schedule_guest</a> (void)</td></tr>
<tr class="memdesc:a7fc2dc4ad4fef314bf988d672c64a65d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Hypervisor scheduler does the job of scheduling between multiple guest OS.  <a href="#a7fc2dc4ad4fef314bf988d672c64a65d">More...</a><br/></td></tr>
<tr class="separator:a7fc2dc4ad4fef314bf988d672c64a65d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afef274d8d521df4f0df8655ffd370d09"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tzhyp__global_8h.html#afef274d8d521df4f0df8655ffd370d09">tzhyp_device_context_init</a> (void)</td></tr>
<tr class="memdesc:afef274d8d521df4f0df8655ffd370d09"><td class="mdescLeft">&#160;</td><td class="mdescRight">Hypervisor device context initialization.  <a href="#afef274d8d521df4f0df8655ffd370d09">More...</a><br/></td></tr>
<tr class="separator:afef274d8d521df4f0df8655ffd370d09"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5182162de4b2dca61076a52abdf56c32"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tzhyp__global_8h.html#a5182162de4b2dca61076a52abdf56c32">tzhyp_device_switch</a> (struct <a class="el" href="structsystem__context.html">system_context</a> *, struct <a class="el" href="structsystem__context.html">system_context</a> *)</td></tr>
<tr class="memdesc:a5182162de4b2dca61076a52abdf56c32"><td class="mdescLeft">&#160;</td><td class="mdescRight">Hypervisor device switching between cur and next.  <a href="#a5182162de4b2dca61076a52abdf56c32">More...</a><br/></td></tr>
<tr class="separator:a5182162de4b2dca61076a52abdf56c32"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac4a708cc6e9ff16d2fdca72bcb9062eb"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tzhyp__global_8h.html#ac4a708cc6e9ff16d2fdca72bcb9062eb">nsk_load</a> (struct <a class="el" href="structnsk__boot__info.html">nsk_boot_info</a> *)</td></tr>
<tr class="memdesc:ac4a708cc6e9ff16d2fdca72bcb9062eb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Loads the non-secure kernel by getting the boot info.  <a href="#ac4a708cc6e9ff16d2fdca72bcb9062eb">More...</a><br/></td></tr>
<tr class="separator:ac4a708cc6e9ff16d2fdca72bcb9062eb"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a510187ef2a59eece79ae2acabb444e85"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structsystem__context.html">system_context</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tzhyp__global_8h.html#a510187ef2a59eece79ae2acabb444e85">ns_world</a> [MAX_CORES *<a class="el" href="tzhyp__config_8h.html#ad2aff408ca4101ac34537fcfeb70dd9e">GUESTS_NO</a>]</td></tr>
<tr class="memdesc:a510187ef2a59eece79ae2acabb444e85"><td class="mdescLeft">&#160;</td><td class="mdescRight">Non secure task contexts.  <a href="#a510187ef2a59eece79ae2acabb444e85">More...</a><br/></td></tr>
<tr class="separator:a510187ef2a59eece79ae2acabb444e85"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afd787304ffa6bed1596d22e7bfbd7822"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structsystem__context.html">system_context</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tzhyp__global_8h.html#afd787304ffa6bed1596d22e7bfbd7822">s_world</a> [1]</td></tr>
<tr class="memdesc:afd787304ffa6bed1596d22e7bfbd7822"><td class="mdescLeft">&#160;</td><td class="mdescRight">Common Secure context.  <a href="#afd787304ffa6bed1596d22e7bfbd7822">More...</a><br/></td></tr>
<tr class="separator:afd787304ffa6bed1596d22e7bfbd7822"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a34c3cf9b08f0d34a32537d6bbc3665e8"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structsystem__context.html">system_context</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tzhyp__global_8h.html#a34c3cf9b08f0d34a32537d6bbc3665e8">ns_sys_current</a></td></tr>
<tr class="memdesc:a34c3cf9b08f0d34a32537d6bbc3665e8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Non secure and Secure context pointers.  <a href="#a34c3cf9b08f0d34a32537d6bbc3665e8">More...</a><br/></td></tr>
<tr class="separator:a34c3cf9b08f0d34a32537d6bbc3665e8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa867880285ec054bc1daa67267dfb46d"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structsystem__context.html">system_context</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tzhyp__global_8h.html#aa867880285ec054bc1daa67267dfb46d">s_sys_current</a></td></tr>
<tr class="separator:aa867880285ec054bc1daa67267dfb46d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad5ad4a14939d009e137f9355d173fc7f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tzhyp__global_8h.html#ad5ad4a14939d009e137f9355d173fc7f">ns_preempt_flag</a></td></tr>
<tr class="memdesc:ad5ad4a14939d009e137f9355d173fc7f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Non secure preempt flag.  <a href="#ad5ad4a14939d009e137f9355d173fc7f">More...</a><br/></td></tr>
<tr class="separator:ad5ad4a14939d009e137f9355d173fc7f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a915d3559bb1ef27274bc79bdc9494e9b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tzhyp__global_8h.html#a915d3559bb1ef27274bc79bdc9494e9b">ns_switch_flag</a></td></tr>
<tr class="memdesc:a915d3559bb1ef27274bc79bdc9494e9b"><td class="mdescLeft">&#160;</td><td class="mdescRight">NS switch flag to indicate TLB flush.  <a href="#a915d3559bb1ef27274bc79bdc9494e9b">More...</a><br/></td></tr>
<tr class="separator:a915d3559bb1ef27274bc79bdc9494e9b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab80b84f64b49218bbbc38ea6e4b69bd9"><td class="memItemLeft" align="right" valign="top"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tzhyp__global_8h.html#ab80b84f64b49218bbbc38ea6e4b69bd9">tzhyp_nsadmin_start</a></td></tr>
<tr class="separator:ab80b84f64b49218bbbc38ea6e4b69bd9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af758da0b088ec96a94f74e7e07d06345"><td class="memItemLeft" align="right" valign="top"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tzhyp__global_8h.html#af758da0b088ec96a94f74e7e07d06345">tzhyp_nsadmin_end</a></td></tr>
<tr class="separator:af758da0b088ec96a94f74e7e07d06345"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3117cb515b08fecff36245423fdcaa4d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tzhyp__global_8h.html#a3117cb515b08fecff36245423fdcaa4d">kernel_start</a></td></tr>
<tr class="separator:a3117cb515b08fecff36245423fdcaa4d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac11b6c102a3ef457074e7e9b9de70ed7"><td class="memItemLeft" align="right" valign="top"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tzhyp__global_8h.html#ac11b6c102a3ef457074e7e9b9de70ed7">kernel_end</a></td></tr>
<tr class="separator:ac11b6c102a3ef457074e7e9b9de70ed7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3dfb3413d1a95c7e24b746205dad9290"><td class="memItemLeft" align="right" valign="top"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tzhyp__global_8h.html#a3dfb3413d1a95c7e24b746205dad9290">kernel_2_start</a></td></tr>
<tr class="separator:a3dfb3413d1a95c7e24b746205dad9290"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7f9f4afccbf62e52546da584b41a26f4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tzhyp__global_8h.html#a7f9f4afccbf62e52546da584b41a26f4">kernel_2_end</a></td></tr>
<tr class="separator:a7f9f4afccbf62e52546da584b41a26f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a624bf2e844207b8faa044229fedc0723"><td class="memItemLeft" align="right" valign="top"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tzhyp__global_8h.html#a624bf2e844207b8faa044229fedc0723">initrd_image_start</a></td></tr>
<tr class="separator:a624bf2e844207b8faa044229fedc0723"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5af709fac04f31ac9b392e81c2332720"><td class="memItemLeft" align="right" valign="top"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tzhyp__global_8h.html#a5af709fac04f31ac9b392e81c2332720">initrd_image_end</a></td></tr>
<tr class="separator:a5af709fac04f31ac9b392e81c2332720"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ac4a708cc6e9ff16d2fdca72bcb9062eb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nsk_load </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structnsk__boot__info.html">nsk_boot_info</a> *&#160;</td>
          <td class="paramname"><em>ni</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Loads the non-secure kernel by getting the boot info. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ni</td><td>boot info structure</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="nsk__loader_8c_source.html#l00051">51</a> of file <a class="el" href="nsk__loader_8c_source.html">nsk_loader.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;{</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        <span class="keywordtype">int</span> error;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;        <a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> ns_map_size, s_map_size, aligned_size;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        </div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;        <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;nsk load:&quot;</span>);</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        aligned_size = ni-&gt;<a class="code" href="structnsk__boot__info.html#a114279662db830c2ff5b519b34f76172">nskbi_size</a>;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        <span class="comment">/* Align it to the next 1MB */</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        <span class="keywordflow">if</span> (aligned_size &amp; (<a class="code" href="nsk__loader_8c.html#a0a82fd70402bbdc2259248e735fecbca">MAP_SIZE</a> - 1)) { </div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;                aligned_size = (aligned_size &amp; <a class="code" href="nsk__loader_8c.html#a9acfa53ba535d32d76682f5d3e893c05">ALIGN_MASK</a>) + <a class="code" href="nsk__loader_8c.html#a0a82fd70402bbdc2259248e735fecbca">MAP_SIZE</a>;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        }</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        </div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        ns_map_size = aligned_size;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        <span class="keywordflow">if</span> (ni-&gt;<a class="code" href="structnsk__boot__info.html#a54c9fda13cd4eb881cb2560b40f9494a">nskbi_loadaddr</a> &amp; (<a class="code" href="nsk__loader_8c.html#a0a82fd70402bbdc2259248e735fecbca">MAP_SIZE</a> - 1)) {</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;                ns_map_size += <a class="code" href="nsk__loader_8c.html#a0a82fd70402bbdc2259248e735fecbca">MAP_SIZE</a>;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        } </div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        <span class="comment">/* map the non secure area */</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        error = <a class="code" href="page__table_8h.html#af2bf59cd4cf882f6589c341b5d952524">map_nsmemsect_normal</a>(ni-&gt;<a class="code" href="structnsk__boot__info.html#a54c9fda13cd4eb881cb2560b40f9494a">nskbi_loadaddr</a> &amp; <a class="code" href="nsk__loader_8c.html#a9acfa53ba535d32d76682f5d3e893c05">ALIGN_MASK</a>,</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;                                     ni-&gt;<a class="code" href="structnsk__boot__info.html#a54c9fda13cd4eb881cb2560b40f9494a">nskbi_loadaddr</a> &amp; <a class="code" href="nsk__loader_8c.html#a9acfa53ba535d32d76682f5d3e893c05">ALIGN_MASK</a>,</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;                                     ns_map_size);</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        <span class="keywordflow">if</span> (error &lt; 0) {</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;                <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;nsk_load: mapping failed\n&quot;</span>);</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;                <span class="keywordflow">return</span> error;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        }</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        s_map_size = aligned_size;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        <span class="comment">/* start address is assumed to be aligned */</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        error = <a class="code" href="page__table_8h.html#a288b10ba6b3e5356af9961adf461f54f">map_secure_memory</a>(ni-&gt;<a class="code" href="structnsk__boot__info.html#a40a531a24f1a7f9253b0811eafd0e1f4">nskbi_srcaddr</a>, ni-&gt;<a class="code" href="structnsk__boot__info.html#a40a531a24f1a7f9253b0811eafd0e1f4">nskbi_srcaddr</a>, </div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                                  s_map_size, <a class="code" href="page__table_8h.html#ae2ddeb1f4469c6950e2ea07290b015c5">PTF_PROT_KRW</a>);</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        <span class="keywordflow">if</span> (error &lt; 0) {</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;                <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;nsk_load: mapping failed\n&quot;</span>);</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                <span class="keywordflow">return</span> error;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        }</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;load addr = %x, startaddr = %x, size = %x\n&quot;</span>, </div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;                  ni-&gt;<a class="code" href="structnsk__boot__info.html#a54c9fda13cd4eb881cb2560b40f9494a">nskbi_loadaddr</a>, ni-&gt;<a class="code" href="structnsk__boot__info.html#a40a531a24f1a7f9253b0811eafd0e1f4">nskbi_srcaddr</a>, ni-&gt;<a class="code" href="structnsk__boot__info.html#a114279662db830c2ff5b519b34f76172">nskbi_size</a>);</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        <span class="comment">/* Move the ns kernel to the load address */</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        <a class="code" href="sw__mem__functions_8h.html#a51ad02aba462d7be9a03231afa56de27">sw_memcpy</a>((<span class="keywordtype">void</span>*)ni-&gt;<a class="code" href="structnsk__boot__info.html#a54c9fda13cd4eb881cb2560b40f9494a">nskbi_loadaddr</a>, (<span class="keywordtype">void</span>*)ni-&gt;<a class="code" href="structnsk__boot__info.html#a40a531a24f1a7f9253b0811eafd0e1f4">nskbi_srcaddr</a>, </div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;                  ni-&gt;<a class="code" href="structnsk__boot__info.html#a114279662db830c2ff5b519b34f76172">nskbi_size</a>);</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        <a class="code" href="cpu_8h.html#a394753c117a76e258bf17fa55a67b1bf">dsb</a>();</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        <a class="code" href="cache_8h.html#a26790473dea7f2879ce3b59948e84e62">flush_cache_all</a>();</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        <span class="comment">/* Unmap the non secure area */</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        <a class="code" href="page__table_8h.html#a6348bfa88047bc937fde445692cb2804">unmap_nsmemsect_normal</a>(ni-&gt;<a class="code" href="structnsk__boot__info.html#a54c9fda13cd4eb881cb2560b40f9494a">nskbi_loadaddr</a>, ns_map_size);</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        <a class="code" href="page__table_8h.html#a052242469f722badd350a69d03e9e88a">unmap_secure_memory</a>(ni-&gt;<a class="code" href="structnsk__boot__info.html#a40a531a24f1a7f9253b0811eafd0e1f4">nskbi_srcaddr</a>, s_map_size);</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        <span class="comment">/* Load initrd */</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        <span class="keywordflow">if</span> (ni-&gt;<a class="code" href="structnsk__boot__info.html#a9678a706eb505df5558cdf0b269d3987">nskbi_initrd_flag</a>) {</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                nsk_initrd_load(ni);</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        }</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;Done\n&quot;</span>);</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;}</div>
<div class="ttc" id="cpu_8h_html_a394753c117a76e258bf17fa55a67b1bf"><div class="ttname"><a href="cpu_8h.html#a394753c117a76e258bf17fa55a67b1bf">dsb</a></div><div class="ttdeci">#define dsb()</div><div class="ttdef"><b>Definition:</b> <a href="cpu_8h_source.html#l00043">cpu.h:43</a></div></div>
<div class="ttc" id="page__table_8h_html_a052242469f722badd350a69d03e9e88a"><div class="ttname"><a href="page__table_8h.html#a052242469f722badd350a69d03e9e88a">unmap_secure_memory</a></div><div class="ttdeci">int unmap_secure_memory(va_t va, u32 size)</div><div class="ttdoc">Unmap a range of secure memory area. </div><div class="ttdef"><b>Definition:</b> <a href="page__table_8c_source.html#l00409">page_table.c:409</a></div></div>
<div class="ttc" id="structnsk__boot__info_html_a54c9fda13cd4eb881cb2560b40f9494a"><div class="ttname"><a href="structnsk__boot__info.html#a54c9fda13cd4eb881cb2560b40f9494a">nsk_boot_info::nskbi_loadaddr</a></div><div class="ttdeci">u32 nskbi_loadaddr</div><div class="ttdef"><b>Definition:</b> <a href="nsk__boot_8h_source.html#l00033">nsk_boot.h:33</a></div></div>
<div class="ttc" id="page__table_8h_html_a288b10ba6b3e5356af9961adf461f54f"><div class="ttname"><a href="page__table_8h.html#a288b10ba6b3e5356af9961adf461f54f">map_secure_memory</a></div><div class="ttdeci">int map_secure_memory(va_t va, pa_t pa, u32 size, u32 ptf)</div><div class="ttdoc">Map a range of secure memory. </div><div class="ttdef"><b>Definition:</b> <a href="page__table_8c_source.html#l00346">page_table.c:346</a></div></div>
<div class="ttc" id="structnsk__boot__info_html_a114279662db830c2ff5b519b34f76172"><div class="ttname"><a href="structnsk__boot__info.html#a114279662db830c2ff5b519b34f76172">nsk_boot_info::nskbi_size</a></div><div class="ttdeci">u32 nskbi_size</div><div class="ttdef"><b>Definition:</b> <a href="nsk__boot_8h_source.html#l00034">nsk_boot.h:34</a></div></div>
<div class="ttc" id="cache_8h_html_a26790473dea7f2879ce3b59948e84e62"><div class="ttname"><a href="cache_8h.html#a26790473dea7f2879ce3b59948e84e62">flush_cache_all</a></div><div class="ttdeci">void flush_cache_all(void)</div></div>
<div class="ttc" id="sw__mem__functions_8h_html_a51ad02aba462d7be9a03231afa56de27"><div class="ttname"><a href="sw__mem__functions_8h.html#a51ad02aba462d7be9a03231afa56de27">sw_memcpy</a></div><div class="ttdeci">void * sw_memcpy(void *dst, const void *src, u32 count)</div><div class="ttdoc">This version of memcpy assumes disjoint ptrs src, dst. </div><div class="ttdef"><b>Definition:</b> <a href="sw__mem__functions_8c_source.html#l00100">sw_mem_functions.c:100</a></div></div>
<div class="ttc" id="page__table_8h_html_af2bf59cd4cf882f6589c341b5d952524"><div class="ttname"><a href="page__table_8h.html#af2bf59cd4cf882f6589c341b5d952524">map_nsmemsect_normal</a></div><div class="ttdeci">int map_nsmemsect_normal(va_t, pa_t, u32)</div><div class="ttdoc">Map a range of non secure memory area as normal memory with attributes Outer and Inner write back...</div><div class="ttdef"><b>Definition:</b> <a href="page__table_8c_source.html#l00442">page_table.c:442</a></div></div>
<div class="ttc" id="nsk__loader_8c_html_a0a82fd70402bbdc2259248e735fecbca"><div class="ttname"><a href="nsk__loader_8c.html#a0a82fd70402bbdc2259248e735fecbca">MAP_SIZE</a></div><div class="ttdeci">#define MAP_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="nsk__loader_8c_source.html#l00038">nsk_loader.c:38</a></div></div>
<div class="ttc" id="nsk__loader_8c_html_a9acfa53ba535d32d76682f5d3e893c05"><div class="ttname"><a href="nsk__loader_8c.html#a9acfa53ba535d32d76682f5d3e893c05">ALIGN_MASK</a></div><div class="ttdeci">#define ALIGN_MASK</div><div class="ttdef"><b>Definition:</b> <a href="nsk__loader_8c_source.html#l00039">nsk_loader.c:39</a></div></div>
<div class="ttc" id="structnsk__boot__info_html_a9678a706eb505df5558cdf0b269d3987"><div class="ttname"><a href="structnsk__boot__info.html#a9678a706eb505df5558cdf0b269d3987">nsk_boot_info::nskbi_initrd_flag</a></div><div class="ttdeci">int nskbi_initrd_flag</div><div class="ttdef"><b>Definition:</b> <a href="nsk__boot_8h_source.html#l00035">nsk_boot.h:35</a></div></div>
<div class="ttc" id="page__table_8h_html_ae2ddeb1f4469c6950e2ea07290b015c5"><div class="ttname"><a href="page__table_8h.html#ae2ddeb1f4469c6950e2ea07290b015c5">PTF_PROT_KRW</a></div><div class="ttdeci">#define PTF_PROT_KRW</div><div class="ttdef"><b>Definition:</b> <a href="page__table_8h_source.html#l00087">page_table.h:87</a></div></div>
<div class="ttc" id="sw__debug_8h_html_a501cc8c07cf94dc1a6269c0d3ba5a234"><div class="ttname"><a href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a></div><div class="ttdeci">u32 sw_printf(const char *fmt,...)</div><div class="ttdoc">Print Function. </div><div class="ttdef"><b>Definition:</b> <a href="sw__debug_8c_source.html#l00046">sw_debug.c:46</a></div></div>
<div class="ttc" id="page__table_8h_html_a6348bfa88047bc937fde445692cb2804"><div class="ttname"><a href="page__table_8h.html#a6348bfa88047bc937fde445692cb2804">unmap_nsmemsect_normal</a></div><div class="ttdeci">int unmap_nsmemsect_normal(va_t, u32)</div><div class="ttdoc">Unmap a range of non secure memory area. </div><div class="ttdef"><b>Definition:</b> <a href="page__table_8c_source.html#l00498">page_table.c:498</a></div></div>
<div class="ttc" id="sw__types_8h_html_a10e94b422ef0c20dcdec20d31a1f5049"><div class="ttname"><a href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a></div><div class="ttdeci">unsigned int u32</div><div class="ttdef"><b>Definition:</b> <a href="sw__types_8h_source.html#l00061">sw_types.h:61</a></div></div>
<div class="ttc" id="structnsk__boot__info_html_a40a531a24f1a7f9253b0811eafd0e1f4"><div class="ttname"><a href="structnsk__boot__info.html#a40a531a24f1a7f9253b0811eafd0e1f4">nsk_boot_info::nskbi_srcaddr</a></div><div class="ttdeci">u32 nskbi_srcaddr</div><div class="ttdef"><b>Definition:</b> <a href="nsk__boot_8h_source.html#l00032">nsk_boot.h:32</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="afef274d8d521df4f0df8655ffd370d09"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void tzhyp_device_context_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Hypervisor device context initialization. </p>

<p>Definition at line <a class="el" href="tzhyp__devices_8c_source.html#l00056">56</a> of file <a class="el" href="tzhyp__devices_8c_source.html">tzhyp_devices.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;{</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        <span class="keyword">struct </span><a class="code" href="structsystem__context.html">system_context</a> *primary_ns_world;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        <span class="keyword">struct </span><a class="code" href="structgic__context.html">gic_context</a> *x;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        primary_ns_world = (<span class="keyword">struct </span><a class="code" href="structsystem__context.html">system_context</a> *)</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;                <a class="code" href="tzhyp_8h.html#abf9fcc9d7278b1c97779800931021925">GET_CORE_CONTEXT_BYID</a>(<a class="code" href="tzhyp__global_8h.html#a510187ef2a59eece79ae2acabb444e85">ns_world</a>, 0);</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        x = &amp;primary_ns_world-&gt;<a class="code" href="structsystem__context.html#a8e68e63790014e21c4c43c3f4a27e426">sysctxt_gic</a>;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        gic_dist_save(x);</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;}</div>
<div class="ttc" id="structsystem__context_html_a8e68e63790014e21c4c43c3f4a27e426"><div class="ttname"><a href="structsystem__context.html#a8e68e63790014e21c4c43c3f4a27e426">system_context::sysctxt_gic</a></div><div class="ttdeci">struct gic_context sysctxt_gic</div><div class="ttdef"><b>Definition:</b> <a href="system__context_8h_source.html#l00136">system_context.h:136</a></div></div>
<div class="ttc" id="tzhyp_8h_html_abf9fcc9d7278b1c97779800931021925"><div class="ttname"><a href="tzhyp_8h.html#abf9fcc9d7278b1c97779800931021925">GET_CORE_CONTEXT_BYID</a></div><div class="ttdeci">#define GET_CORE_CONTEXT_BYID(context, id)</div><div class="ttdef"><b>Definition:</b> <a href="tzhyp_8h_source.html#l00038">tzhyp.h:38</a></div></div>
<div class="ttc" id="structgic__context_html"><div class="ttname"><a href="structgic__context.html">gic_context</a></div><div class="ttdef"><b>Definition:</b> <a href="system__context_8h_source.html#l00098">system_context.h:98</a></div></div>
<div class="ttc" id="structsystem__context_html"><div class="ttname"><a href="structsystem__context.html">system_context</a></div><div class="ttdef"><b>Definition:</b> <a href="system__context_8h_source.html#l00131">system_context.h:131</a></div></div>
<div class="ttc" id="tzhyp__global_8h_html_a510187ef2a59eece79ae2acabb444e85"><div class="ttname"><a href="tzhyp__global_8h.html#a510187ef2a59eece79ae2acabb444e85">ns_world</a></div><div class="ttdeci">struct system_context ns_world[MAX_CORES *GUESTS_NO]</div><div class="ttdoc">Non secure task contexts. </div><div class="ttdef"><b>Definition:</b> <a href="tzhyp_8c_source.html#l00040">tzhyp.c:40</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5182162de4b2dca61076a52abdf56c32"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void tzhyp_device_switch </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structsystem__context.html">system_context</a> *&#160;</td>
          <td class="paramname"><em>cur</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structsystem__context.html">system_context</a> *&#160;</td>
          <td class="paramname"><em>next</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Hypervisor device switching between cur and next. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cur</td><td></td></tr>
    <tr><td class="paramname">next</td><td></td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="tzhyp__devices_8c_source.html#l00042">42</a> of file <a class="el" href="tzhyp__devices_8c_source.html">tzhyp_devices.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;{</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="cpu_8h.html#a699bd58190ccf9fe1d1609d9f3da8ff1">get_cpu_id</a>() == 0) {</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;                <span class="comment">/* Save and restore gic state */</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;                gic_dist_save(&amp;cur-&gt;<a class="code" href="structsystem__context.html#a8e68e63790014e21c4c43c3f4a27e426">sysctxt_gic</a>);</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;                gic_dist_restore(&amp;next-&gt;<a class="code" href="structsystem__context.html#a8e68e63790014e21c4c43c3f4a27e426">sysctxt_gic</a>);</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        }</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;}</div>
<div class="ttc" id="structsystem__context_html_a8e68e63790014e21c4c43c3f4a27e426"><div class="ttname"><a href="structsystem__context.html#a8e68e63790014e21c4c43c3f4a27e426">system_context::sysctxt_gic</a></div><div class="ttdeci">struct gic_context sysctxt_gic</div><div class="ttdef"><b>Definition:</b> <a href="system__context_8h_source.html#l00136">system_context.h:136</a></div></div>
<div class="ttc" id="cpu_8h_html_a699bd58190ccf9fe1d1609d9f3da8ff1"><div class="ttname"><a href="cpu_8h.html#a699bd58190ccf9fe1d1609d9f3da8ff1">get_cpu_id</a></div><div class="ttdeci">u32 get_cpu_id(void)</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a066643f2506655454be4342f325fc557"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int tzhyp_guest_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize guests. </p>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="tzhyp__boot_8c_source.html#l00068">68</a> of file <a class="el" href="tzhyp__boot_8c_source.html">tzhyp_boot.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;{</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        <span class="keywordtype">int</span> guest;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        <span class="comment">/* Initialize Guest 1 */</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        guest = 0;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        <span class="comment">/* Assuming both start and load address are 1mb aligned*/</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        ns_world_binfo[guest].<a class="code" href="structnsk__boot__info.html#a40a531a24f1a7f9253b0811eafd0e1f4">nskbi_srcaddr</a> = (<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>)&amp;<a class="code" href="tzhyp__global_8h.html#a3117cb515b08fecff36245423fdcaa4d">kernel_start</a>; </div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        ns_world_binfo[guest].<a class="code" href="structnsk__boot__info.html#a54c9fda13cd4eb881cb2560b40f9494a">nskbi_loadaddr</a> = <a class="code" href="sw__board_8h.html#a4ad9520cf5851eb6621674013368193a">NSK_LOAD_ADDRESS</a>; </div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        ns_world_binfo[guest].<a class="code" href="structnsk__boot__info.html#a114279662db830c2ff5b519b34f76172">nskbi_size</a>  = </div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;                ((<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>)&amp;<a class="code" href="tzhyp__global_8h.html#ac11b6c102a3ef457074e7e9b9de70ed7">kernel_end</a>) - ((<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>)&amp;<a class="code" href="tzhyp__global_8h.html#a3117cb515b08fecff36245423fdcaa4d">kernel_start</a>);</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        ns_world_binfo[guest].<a class="code" href="structnsk__boot__info.html#a9678a706eb505df5558cdf0b269d3987">nskbi_initrd_flag</a> = 0;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        </div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="preprocessor">#ifdef CONFIG_MULTI_GUESTS_SUPPORT</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="preprocessor"></span>        <span class="comment">/* Initialize Guest 2 */</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        guest = 1;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        <span class="comment">/* Assuming both start and load address are 1mb aligned*/</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        ns_world_binfo[guest].<a class="code" href="structnsk__boot__info.html#a40a531a24f1a7f9253b0811eafd0e1f4">nskbi_srcaddr</a> = (<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>)&amp;<a class="code" href="tzhyp__global_8h.html#a3dfb3413d1a95c7e24b746205dad9290">kernel_2_start</a>; </div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        ns_world_binfo[guest].<a class="code" href="structnsk__boot__info.html#a54c9fda13cd4eb881cb2560b40f9494a">nskbi_loadaddr</a> = </div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;                <a class="code" href="sw__board_8h.html#a4ad9520cf5851eb6621674013368193a">NSK_LOAD_ADDRESS</a> + <a class="code" href="sw__board_8h.html#a42cb319ce8889ea46165d4d583f19567">GUEST_MEM_SIZE</a>; </div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        ns_world_binfo[guest].<a class="code" href="structnsk__boot__info.html#a114279662db830c2ff5b519b34f76172">nskbi_size</a>  = </div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                ((<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>)&amp;<a class="code" href="tzhyp__global_8h.html#a7f9f4afccbf62e52546da584b41a26f4">kernel_2_end</a>) - ((<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>)&amp;<a class="code" href="tzhyp__global_8h.html#a3dfb3413d1a95c7e24b746205dad9290">kernel_2_start</a>);</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="preprocessor">#ifndef CONFIG_ZYNQ7_BOARD      </span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="preprocessor"></span>        <span class="comment">/* Use initrd for the second guest */</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        ns_world_binfo[guest].<a class="code" href="structnsk__boot__info.html#a9678a706eb505df5558cdf0b269d3987">nskbi_initrd_flag</a> = 1;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        ns_world_binfo[guest].<a class="code" href="structnsk__boot__info.html#afbadb2e0138969ddcbbb89e68275d38b">nskbi_initrd_sa</a> = &amp;<a class="code" href="tzhyp__global_8h.html#a624bf2e844207b8faa044229fedc0723">initrd_image_start</a>;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        ns_world_binfo[guest].<a class="code" href="structnsk__boot__info.html#a96777b81dc528eeb26a83e616886512a">nskbi_initrd_la</a> = LINUX_INITRD_ADDR;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        ns_world_binfo[guest].<a class="code" href="structnsk__boot__info.html#a55c267cda6c352da83a2d2fd87d07abc">nskbi_initrd_size</a> = </div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                ((<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>)&amp;<a class="code" href="tzhyp__global_8h.html#a5af709fac04f31ac9b392e81c2332720">initrd_image_end</a>) - ((<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>)&amp;<a class="code" href="tzhyp__global_8h.html#a624bf2e844207b8faa044229fedc0723">initrd_image_start</a>);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        <span class="comment">/* Load all the guests to memory */</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        tzhyp_load_guests();</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        <span class="comment">/* Initialize the register context for all the guests */</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        tzhyp_guest_context_init();</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;}</div>
<div class="ttc" id="structnsk__boot__info_html_a96777b81dc528eeb26a83e616886512a"><div class="ttname"><a href="structnsk__boot__info.html#a96777b81dc528eeb26a83e616886512a">nsk_boot_info::nskbi_initrd_la</a></div><div class="ttdeci">u32 nskbi_initrd_la</div><div class="ttdef"><b>Definition:</b> <a href="nsk__boot_8h_source.html#l00037">nsk_boot.h:37</a></div></div>
<div class="ttc" id="tzhyp__global_8h_html_a3dfb3413d1a95c7e24b746205dad9290"><div class="ttname"><a href="tzhyp__global_8h.html#a3dfb3413d1a95c7e24b746205dad9290">kernel_2_start</a></div><div class="ttdeci">u32 kernel_2_start</div></div>
<div class="ttc" id="structnsk__boot__info_html_a54c9fda13cd4eb881cb2560b40f9494a"><div class="ttname"><a href="structnsk__boot__info.html#a54c9fda13cd4eb881cb2560b40f9494a">nsk_boot_info::nskbi_loadaddr</a></div><div class="ttdeci">u32 nskbi_loadaddr</div><div class="ttdef"><b>Definition:</b> <a href="nsk__boot_8h_source.html#l00033">nsk_boot.h:33</a></div></div>
<div class="ttc" id="structnsk__boot__info_html_a114279662db830c2ff5b519b34f76172"><div class="ttname"><a href="structnsk__boot__info.html#a114279662db830c2ff5b519b34f76172">nsk_boot_info::nskbi_size</a></div><div class="ttdeci">u32 nskbi_size</div><div class="ttdef"><b>Definition:</b> <a href="nsk__boot_8h_source.html#l00034">nsk_boot.h:34</a></div></div>
<div class="ttc" id="structnsk__boot__info_html_a55c267cda6c352da83a2d2fd87d07abc"><div class="ttname"><a href="structnsk__boot__info.html#a55c267cda6c352da83a2d2fd87d07abc">nsk_boot_info::nskbi_initrd_size</a></div><div class="ttdeci">u32 nskbi_initrd_size</div><div class="ttdef"><b>Definition:</b> <a href="nsk__boot_8h_source.html#l00038">nsk_boot.h:38</a></div></div>
<div class="ttc" id="tzhyp__global_8h_html_a5af709fac04f31ac9b392e81c2332720"><div class="ttname"><a href="tzhyp__global_8h.html#a5af709fac04f31ac9b392e81c2332720">initrd_image_end</a></div><div class="ttdeci">u32 initrd_image_end</div></div>
<div class="ttc" id="sw__board_8h_html_a42cb319ce8889ea46165d4d583f19567"><div class="ttname"><a href="sw__board_8h.html#a42cb319ce8889ea46165d4d583f19567">GUEST_MEM_SIZE</a></div><div class="ttdeci">#define GUEST_MEM_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="sw__board_8h_source.html#l00039">sw_board.h:39</a></div></div>
<div class="ttc" id="structnsk__boot__info_html_a9678a706eb505df5558cdf0b269d3987"><div class="ttname"><a href="structnsk__boot__info.html#a9678a706eb505df5558cdf0b269d3987">nsk_boot_info::nskbi_initrd_flag</a></div><div class="ttdeci">int nskbi_initrd_flag</div><div class="ttdef"><b>Definition:</b> <a href="nsk__boot_8h_source.html#l00035">nsk_boot.h:35</a></div></div>
<div class="ttc" id="tzhyp__global_8h_html_a3117cb515b08fecff36245423fdcaa4d"><div class="ttname"><a href="tzhyp__global_8h.html#a3117cb515b08fecff36245423fdcaa4d">kernel_start</a></div><div class="ttdeci">u32 kernel_start</div></div>
<div class="ttc" id="tzhyp__global_8h_html_ac11b6c102a3ef457074e7e9b9de70ed7"><div class="ttname"><a href="tzhyp__global_8h.html#ac11b6c102a3ef457074e7e9b9de70ed7">kernel_end</a></div><div class="ttdeci">u32 kernel_end</div></div>
<div class="ttc" id="tzhyp__global_8h_html_a624bf2e844207b8faa044229fedc0723"><div class="ttname"><a href="tzhyp__global_8h.html#a624bf2e844207b8faa044229fedc0723">initrd_image_start</a></div><div class="ttdeci">u32 initrd_image_start</div></div>
<div class="ttc" id="sw__board_8h_html_a4ad9520cf5851eb6621674013368193a"><div class="ttname"><a href="sw__board_8h.html#a4ad9520cf5851eb6621674013368193a">NSK_LOAD_ADDRESS</a></div><div class="ttdeci">#define NSK_LOAD_ADDRESS</div><div class="ttdef"><b>Definition:</b> <a href="sw__board_8h_source.html#l00037">sw_board.h:37</a></div></div>
<div class="ttc" id="structnsk__boot__info_html_afbadb2e0138969ddcbbb89e68275d38b"><div class="ttname"><a href="structnsk__boot__info.html#afbadb2e0138969ddcbbb89e68275d38b">nsk_boot_info::nskbi_initrd_sa</a></div><div class="ttdeci">u32 nskbi_initrd_sa</div><div class="ttdef"><b>Definition:</b> <a href="nsk__boot_8h_source.html#l00036">nsk_boot.h:36</a></div></div>
<div class="ttc" id="sw__types_8h_html_a10e94b422ef0c20dcdec20d31a1f5049"><div class="ttname"><a href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a></div><div class="ttdeci">unsigned int u32</div><div class="ttdef"><b>Definition:</b> <a href="sw__types_8h_source.html#l00061">sw_types.h:61</a></div></div>
<div class="ttc" id="structnsk__boot__info_html_a40a531a24f1a7f9253b0811eafd0e1f4"><div class="ttname"><a href="structnsk__boot__info.html#a40a531a24f1a7f9253b0811eafd0e1f4">nsk_boot_info::nskbi_srcaddr</a></div><div class="ttdeci">u32 nskbi_srcaddr</div><div class="ttdef"><b>Definition:</b> <a href="nsk__boot_8h_source.html#l00032">nsk_boot.h:32</a></div></div>
<div class="ttc" id="tzhyp__global_8h_html_a7f9f4afccbf62e52546da584b41a26f4"><div class="ttname"><a href="tzhyp__global_8h.html#a7f9f4afccbf62e52546da584b41a26f4">kernel_2_end</a></div><div class="ttdeci">u32 kernel_2_end</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4591534998b0845f3bd6f56f2851616b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int tzhyp_schedevent_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Trustzone hypervisor schedule event initialization. </p>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="tzhyp__sched_8c_source.html#l00109">109</a> of file <a class="el" href="tzhyp__sched_8c_source.html">tzhyp_sched.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;{</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="preprocessor">#ifdef SW_OTZHYP_DEBUG    </span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="preprocessor"></span>        <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;tzhyp_schedevent_init\n&quot;</span>);</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        tzhypsched_event = <a class="code" href="sw__timer_8h.html#a37105580638257400682808d9dd0d684">timer_event_create</a>(&amp;tzhyp_schedevent_handler, </div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                                              (<span class="keywordtype">void</span>*)<a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        <span class="keywordflow">if</span>(!tzhypsched_event){</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;xxx : Cannot register Handler\n&quot;</span>);</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        }</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        <span class="comment">/* Time duration = 40ms */</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        tzhypsched_time.<a class="code" href="uniontimeval__t.html#a744c01516c3a376cb67bfa8a0a3d0900">tval</a>.<a class="code" href="uniontimeval__t.html#a85f38542a8fa84ce968e2297bf8f7487">nsec</a> = 40000000;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        tzhypsched_time.<a class="code" href="uniontimeval__t.html#a744c01516c3a376cb67bfa8a0a3d0900">tval</a>.<a class="code" href="uniontimeval__t.html#a9c6a9d36de22b39f398f77325ee07539">sec</a> = 0;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        <a class="code" href="sw__timer_8h.html#ae9578a02129a7b5c79e395fe76d4562c">timer_event_start</a>(tzhypsched_event, &amp;tzhypsched_time);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;}</div>
<div class="ttc" id="uniontimeval__t_html_a744c01516c3a376cb67bfa8a0a3d0900"><div class="ttname"><a href="uniontimeval__t.html#a744c01516c3a376cb67bfa8a0a3d0900">timeval_t::tval</a></div><div class="ttdeci">struct timeval_t::@10 tval</div></div>
<div class="ttc" id="sw__types_8h_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="sw__types_8h_source.html#l00039">sw_types.h:39</a></div></div>
<div class="ttc" id="uniontimeval__t_html_a9c6a9d36de22b39f398f77325ee07539"><div class="ttname"><a href="uniontimeval__t.html#a9c6a9d36de22b39f398f77325ee07539">timeval_t::sec</a></div><div class="ttdeci">s32 sec</div><div class="ttdef"><b>Definition:</b> <a href="sw__timer_8h_source.html#l00056">sw_timer.h:56</a></div></div>
<div class="ttc" id="sw__timer_8h_html_ae9578a02129a7b5c79e395fe76d4562c"><div class="ttname"><a href="sw__timer_8h.html#ae9578a02129a7b5c79e395fe76d4562c">timer_event_start</a></div><div class="ttdeci">void timer_event_start(struct timer_event *tevent, timeval_t *time)</div><div class="ttdoc">It starts the timer event by calling the appropriate functions The time interval is written to the ha...</div><div class="ttdef"><b>Definition:</b> <a href="sw__timer_8c_source.html#l00485">sw_timer.c:485</a></div></div>
<div class="ttc" id="sw__debug_8h_html_a501cc8c07cf94dc1a6269c0d3ba5a234"><div class="ttname"><a href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a></div><div class="ttdeci">u32 sw_printf(const char *fmt,...)</div><div class="ttdoc">Print Function. </div><div class="ttdef"><b>Definition:</b> <a href="sw__debug_8c_source.html#l00046">sw_debug.c:46</a></div></div>
<div class="ttc" id="sw__timer_8h_html_a37105580638257400682808d9dd0d684"><div class="ttname"><a href="sw__timer_8h.html#a37105580638257400682808d9dd0d684">timer_event_create</a></div><div class="ttdeci">struct timer_event * timer_event_create(sw_timer_event_handler handler, void *priv_data)</div><div class="ttdoc">This function is called to create a new timer event. It allocates the memory for timer event struct...</div><div class="ttdef"><b>Definition:</b> <a href="sw__timer_8c_source.html#l00344">sw_timer.c:344</a></div></div>
<div class="ttc" id="uniontimeval__t_html_a85f38542a8fa84ce968e2297bf8f7487"><div class="ttname"><a href="uniontimeval__t.html#a85f38542a8fa84ce968e2297bf8f7487">timeval_t::nsec</a></div><div class="ttdeci">s32 nsec</div><div class="ttdef"><b>Definition:</b> <a href="sw__timer_8h_source.html#l00056">sw_timer.h:56</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a7fc2dc4ad4fef314bf988d672c64a65d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void tzhyp_schedule_guest </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Hypervisor scheduler does the job of scheduling between multiple guest OS. </p>
<p>CPU context switching to a new guest OS For every guest OS there is a cpu register context meant for NS world. Secure world is common across all guest OS. CPU register context involves both core registers and system registers(eg. cp15). a. The sytem register context of the 'current' guest OS(NS world) is saved and the same is restored with that of the 'next' guest OS to be scheduled. b. Saving and restoring of core registers(NS world) is handled by the monitor fiq handler entry and exit path. So we just need to adjust he context pointers so that the right core register context gets restored during exit from the exception.</p>

<p>Definition at line <a class="el" href="tzhyp__sched_8c_source.html#l00050">50</a> of file <a class="el" href="tzhyp__sched_8c_source.html">tzhyp_sched.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;{</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;        <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structsystem__context.html">system_context</a> *boundary = &amp;<a class="code" href="tzhyp__global_8h.html#a510187ef2a59eece79ae2acabb444e85">ns_world</a>[0] + <a class="code" href="tzhyp__config_8h.html#ad2aff408ca4101ac34537fcfeb70dd9e">GUESTS_NO</a>;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        <span class="keyword">struct </span><a class="code" href="structsystem__context.html">system_context</a> *<a class="code" href="sw__buddy_8h.html#ad05441302211504d54462741b9a97b3a">current</a>, *next;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#ifdef SCHEDULE_HIGH_PRIORITY_GUEST</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor"></span>        <span class="keyword">static</span> <a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> <a class="code" href="virtual__keyboard_8c.html#a16ff2d8e15ade4948398b0aeb80124a8">count</a> = 0, low_priority_guest_scheduled = 0;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor">#ifdef SW_OTZHYP_DEBUG    </span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor"></span>        <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;tzhyp_sched_guest\n&quot;</span>);</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        current = <a class="code" href="tzhyp__global_8h.html#a34c3cf9b08f0d34a32537d6bbc3665e8">ns_sys_current</a>;       </div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="preprocessor">#ifdef SCHEDULE_HIGH_PRIORITY_GUEST</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="preprocessor"></span>        <span class="keywordflow">if</span>(current-&gt;<a class="code" href="structsystem__context.html#abaa5314fa254317d5d7352de34e76be7">guest_no</a> != HIGH_PRIORITY_GUEST)</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;                low_priority_guest_scheduled = 1;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="keywordflow">if</span>(low_priority_guest_scheduled &amp;&amp; </div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        is_guest_irq_active(current-&gt;<a class="code" href="structsystem__context.html#abaa5314fa254317d5d7352de34e76be7">guest_no</a>)) {</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        <span class="comment">/* Schedule the low priorty guest @ 800 milli seconds interval</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">            40ms * 20 = 800 milli seconds */</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        <span class="keywordflow">if</span>(count &lt; 20) {</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;            count ++;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;            <span class="keywordflow">return</span> current-&gt;<a class="code" href="structsystem__context.html#abaa5314fa254317d5d7352de34e76be7">guest_no</a>;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        }</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;            count = 0;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        }</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    }</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        next = <a class="code" href="tzhyp__global_8h.html#a34c3cf9b08f0d34a32537d6bbc3665e8">ns_sys_current</a> + 1;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        <span class="keywordflow">if</span> (next &gt;= boundary) <span class="comment">/* reset to index 0 */</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;                next = <a class="code" href="tzhyp__global_8h.html#a510187ef2a59eece79ae2acabb444e85">ns_world</a>;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="preprocessor">#ifdef SW_OTZHYP_DEBUG    </span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="preprocessor"></span>        <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;current = %x, next = %x\n&quot;</span>, current, next);</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        <a class="code" href="tzhyp__global_8h.html#a34c3cf9b08f0d34a32537d6bbc3665e8">ns_sys_current</a> = next;  </div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        <a class="code" href="system__context_8h.html#a06c884f469b1655d2a8aa6c2d951198a">tzhyp_sysregs_switch</a>(&amp;current-&gt;<a class="code" href="structsystem__context.html#a7c7c863469000c7b1777c62c4c14fe56">sysctxt_cp15</a>, &amp;next-&gt;<a class="code" href="structsystem__context.html#a7c7c863469000c7b1777c62c4c14fe56">sysctxt_cp15</a>);</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        <a class="code" href="tzhyp__global_8h.html#a5182162de4b2dca61076a52abdf56c32">tzhyp_device_switch</a>(current, next);</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;}</div>
<div class="ttc" id="structsystem__context_html_abaa5314fa254317d5d7352de34e76be7"><div class="ttname"><a href="structsystem__context.html#abaa5314fa254317d5d7352de34e76be7">system_context::guest_no</a></div><div class="ttdeci">u32 guest_no</div><div class="ttdef"><b>Definition:</b> <a href="system__context_8h_source.html#l00141">system_context.h:141</a></div></div>
<div class="ttc" id="tzhyp__config_8h_html_ad2aff408ca4101ac34537fcfeb70dd9e"><div class="ttname"><a href="tzhyp__config_8h.html#ad2aff408ca4101ac34537fcfeb70dd9e">GUESTS_NO</a></div><div class="ttdeci">#define GUESTS_NO</div><div class="ttdef"><b>Definition:</b> <a href="tzhyp__config_8h_source.html#l00033">tzhyp_config.h:33</a></div></div>
<div class="ttc" id="sw__buddy_8h_html_ad05441302211504d54462741b9a97b3a"><div class="ttname"><a href="sw__buddy_8h.html#ad05441302211504d54462741b9a97b3a">current</a></div><div class="ttdeci">struct sw_alloced_area current</div><div class="ttdef"><b>Definition:</b> <a href="sw__buddy_8h_source.html#l00040">sw_buddy.h:40</a></div></div>
<div class="ttc" id="tzhyp__global_8h_html_a34c3cf9b08f0d34a32537d6bbc3665e8"><div class="ttname"><a href="tzhyp__global_8h.html#a34c3cf9b08f0d34a32537d6bbc3665e8">ns_sys_current</a></div><div class="ttdeci">struct system_context * ns_sys_current</div><div class="ttdoc">Non secure and Secure context pointers. </div><div class="ttdef"><b>Definition:</b> <a href="tzhyp_8c_source.html#l00050">tzhyp.c:50</a></div></div>
<div class="ttc" id="structsystem__context_html_a7c7c863469000c7b1777c62c4c14fe56"><div class="ttname"><a href="structsystem__context.html#a7c7c863469000c7b1777c62c4c14fe56">system_context::sysctxt_cp15</a></div><div class="ttdeci">struct cp15_context sysctxt_cp15</div><div class="ttdef"><b>Definition:</b> <a href="system__context_8h_source.html#l00134">system_context.h:134</a></div></div>
<div class="ttc" id="system__context_8h_html_a06c884f469b1655d2a8aa6c2d951198a"><div class="ttname"><a href="system__context_8h.html#a06c884f469b1655d2a8aa6c2d951198a">tzhyp_sysregs_switch</a></div><div class="ttdeci">void tzhyp_sysregs_switch(struct cp15_context *reg1, struct cp15_context *reg2)</div></div>
<div class="ttc" id="structsystem__context_html"><div class="ttname"><a href="structsystem__context.html">system_context</a></div><div class="ttdef"><b>Definition:</b> <a href="system__context_8h_source.html#l00131">system_context.h:131</a></div></div>
<div class="ttc" id="sw__debug_8h_html_a501cc8c07cf94dc1a6269c0d3ba5a234"><div class="ttname"><a href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a></div><div class="ttdeci">u32 sw_printf(const char *fmt,...)</div><div class="ttdoc">Print Function. </div><div class="ttdef"><b>Definition:</b> <a href="sw__debug_8c_source.html#l00046">sw_debug.c:46</a></div></div>
<div class="ttc" id="virtual__keyboard_8c_html_a16ff2d8e15ade4948398b0aeb80124a8"><div class="ttname"><a href="virtual__keyboard_8c.html#a16ff2d8e15ade4948398b0aeb80124a8">count</a></div><div class="ttdeci">s32int count</div><div class="ttdef"><b>Definition:</b> <a href="virtual__keyboard_8c_source.html#l00038">virtual_keyboard.c:38</a></div></div>
<div class="ttc" id="tzhyp__global_8h_html_a510187ef2a59eece79ae2acabb444e85"><div class="ttname"><a href="tzhyp__global_8h.html#a510187ef2a59eece79ae2acabb444e85">ns_world</a></div><div class="ttdeci">struct system_context ns_world[MAX_CORES *GUESTS_NO]</div><div class="ttdoc">Non secure task contexts. </div><div class="ttdef"><b>Definition:</b> <a href="tzhyp_8c_source.html#l00040">tzhyp.c:40</a></div></div>
<div class="ttc" id="sw__types_8h_html_a10e94b422ef0c20dcdec20d31a1f5049"><div class="ttname"><a href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a></div><div class="ttdeci">unsigned int u32</div><div class="ttdef"><b>Definition:</b> <a href="sw__types_8h_source.html#l00061">sw_types.h:61</a></div></div>
<div class="ttc" id="tzhyp__global_8h_html_a5182162de4b2dca61076a52abdf56c32"><div class="ttname"><a href="tzhyp__global_8h.html#a5182162de4b2dca61076a52abdf56c32">tzhyp_device_switch</a></div><div class="ttdeci">void tzhyp_device_switch(struct system_context *, struct system_context *)</div><div class="ttdoc">Hypervisor device switching between cur and next. </div><div class="ttdef"><b>Definition:</b> <a href="tzhyp__devices_8c_source.html#l00042">tzhyp_devices.c:42</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="a5af709fac04f31ac9b392e81c2332720"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> initrd_image_end</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a624bf2e844207b8faa044229fedc0723"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> initrd_image_start</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a7f9f4afccbf62e52546da584b41a26f4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> kernel_2_end</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a3dfb3413d1a95c7e24b746205dad9290"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> kernel_2_start</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="ac11b6c102a3ef457074e7e9b9de70ed7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> kernel_end</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a3117cb515b08fecff36245423fdcaa4d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> kernel_start</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="ad5ad4a14939d009e137f9355d173fc7f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> ns_preempt_flag</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Non secure preempt flag. </p>

<p>Definition at line <a class="el" href="tzhyp_8c_source.html#l00061">61</a> of file <a class="el" href="tzhyp_8c_source.html">tzhyp.c</a>.</p>

</div>
</div>
<a class="anchor" id="a915d3559bb1ef27274bc79bdc9494e9b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> ns_switch_flag</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>NS switch flag to indicate TLB flush. </p>

<p>Definition at line <a class="el" href="tzhyp_8c_source.html#l00066">66</a> of file <a class="el" href="tzhyp_8c_source.html">tzhyp.c</a>.</p>

</div>
</div>
<a class="anchor" id="a34c3cf9b08f0d34a32537d6bbc3665e8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structsystem__context.html">system_context</a>* ns_sys_current</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Non secure and Secure context pointers. </p>

<p>Definition at line <a class="el" href="tzhyp_8c_source.html#l00050">50</a> of file <a class="el" href="tzhyp_8c_source.html">tzhyp.c</a>.</p>

</div>
</div>
<a class="anchor" id="a510187ef2a59eece79ae2acabb444e85"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structsystem__context.html">system_context</a> ns_world[MAX_CORES *<a class="el" href="tzhyp__config_8h.html#ad2aff408ca4101ac34537fcfeb70dd9e">GUESTS_NO</a>]</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Non secure task contexts. </p>
<p>Non secure task contexts. </p>

<p>Definition at line <a class="el" href="tzhyp_8c_source.html#l00040">40</a> of file <a class="el" href="tzhyp_8c_source.html">tzhyp.c</a>.</p>

</div>
</div>
<a class="anchor" id="aa867880285ec054bc1daa67267dfb46d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structsystem__context.html">system_context</a>* s_sys_current</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="tzhyp_8c_source.html#l00056">56</a> of file <a class="el" href="tzhyp_8c_source.html">tzhyp.c</a>.</p>

</div>
</div>
<a class="anchor" id="afd787304ffa6bed1596d22e7bfbd7822"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structsystem__context.html">system_context</a> s_world[1]</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Common Secure context. </p>
<p>Common Secure context. </p>

<p>Definition at line <a class="el" href="tzhyp_8c_source.html#l00045">45</a> of file <a class="el" href="tzhyp_8c_source.html">tzhyp.c</a>.</p>

</div>
</div>
<a class="anchor" id="af758da0b088ec96a94f74e7e07d06345"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> tzhyp_nsadmin_end</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="ab80b84f64b49218bbbc38ea6e4b69bd9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> tzhyp_nsadmin_start</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat May 3 2014 13:35:45 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
