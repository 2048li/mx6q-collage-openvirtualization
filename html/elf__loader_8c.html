<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>elf_loader.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_6aeebb853ebd8c514e6186653c592c82.html">otzone</a></li><li class="navelem"><a class="el" href="dir_fb44076c8b62c63869cf8a830933e50d.html">src</a></li><li class="navelem"><a class="el" href="dir_5054d892aa124e015c653e8232659643.html">arch</a></li><li class="navelem"><a class="el" href="dir_a8ff73de53c273984b8a08f3bd00cae5.html">arm</a></li><li class="navelem"><a class="el" href="dir_0f6da8a9c5259cd162214505231682b4.html">armv7</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">elf_loader.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="elf_8h_source.html">elf.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="task_8h_source.html">task.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="secure__api_8h_source.html">secure_api.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="sw__debug_8h_source.html">sw_debug.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="otz__id_8h_source.html">otz_id.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="fat32_8h_source.html">fat32.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="page__table_8h_source.html">page_table.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="dispatcher__task_8h_source.html">dispatcher_task.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="sw__string__functions_8h_source.html">sw_string_functions.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="sw__mem__functions_8h_source.html">sw_mem_functions.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="mem__mng_8h_source.html">mem_mng.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="sw__list_8h_source.html">sw_list.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="cpu__data_8h_source.html">cpu_data.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="sw__types_8h_source.html">sw_types.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="elf__loader__app_8h_source.html">elf_loader_app.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="elf__loader_8h_source.html">elf_loader.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="sw__board_8h_source.html">sw_board.h</a>&gt;</code><br/>
</div>
<p><a href="elf__loader_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ad0cb393dc26e87df4d12de04f9889b2d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="elf__loader_8c.html#ad0cb393dc26e87df4d12de04f9889b2d">__KSYMTAB_ADDR</a>&#160;&#160;&#160;((<a class="el" href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a> *)&amp;<a class="el" href="cpu__data_8h.html#a01574a4c757686b05cf653e478de2457">_SW_KSYMTAB</a>)</td></tr>
<tr class="separator:ad0cb393dc26e87df4d12de04f9889b2d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ab6814f634bead0f3ecd360e88acd9df8"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="elf__loader_8c.html#ab6814f634bead0f3ecd360e88acd9df8">elf_loader_cleanup</a> (void)</td></tr>
<tr class="memdesc:ab6814f634bead0f3ecd360e88acd9df8"><td class="mdescLeft">&#160;</td><td class="mdescRight">clean up function to remove the mappings  <a href="#ab6814f634bead0f3ecd360e88acd9df8">More...</a><br/></td></tr>
<tr class="separator:ab6814f634bead0f3ecd360e88acd9df8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa6f94b3aa31ace269a815e3faf5f3a63"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="elf__loader_8c.html#aa6f94b3aa31ace269a815e3faf5f3a63">elf_load</a> (struct <a class="el" href="structsa__config__t.html">sa_config_t</a> *conf)</td></tr>
<tr class="memdesc:aa6f94b3aa31ace269a815e3faf5f3a63"><td class="mdescLeft">&#160;</td><td class="mdescRight">the main elf loader function  <a href="#aa6f94b3aa31ace269a815e3faf5f3a63">More...</a><br/></td></tr>
<tr class="separator:aa6f94b3aa31ace269a815e3faf5f3a63"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="ad0cb393dc26e87df4d12de04f9889b2d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define __KSYMTAB_ADDR&#160;&#160;&#160;((<a class="el" href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a> *)&amp;<a class="el" href="cpu__data_8h.html#a01574a4c757686b05cf653e478de2457">_SW_KSYMTAB</a>)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="elf__loader_8c_source.html#l00048">48</a> of file <a class="el" href="elf__loader_8c_source.html">elf_loader.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="aa6f94b3aa31ace269a815e3faf5f3a63"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int elf_load </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structsa__config__t.html">sa_config_t</a> *&#160;</td>
          <td class="paramname"><em>conf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>the main elf loader function </p>
<p>The main loader function which will be called by the <a class="el" href="sw__syscall_8h.html#ac0f29297004391a1e1557007fb5f8d7a" title="system call to usleep ">__elf_load()</a> syscall, has functionality for handling both relocatable files and executable files, although executable file support is not required as of now, so control doesn't go to the executable file part of the function.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">conf</td><td>: configuration parameter for the task</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, -1 on failure </dd></dl>

<p>Definition at line <a class="el" href="elf__loader_8c_source.html#l00676">676</a> of file <a class="el" href="elf__loader_8c_source.html">elf_loader.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;{</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;        <a class="code" href="structElf32__Ehdr.html">Elf32_Ehdr</a> elf_header;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;        <a class="code" href="structElf32__Ehdr.html">Elf32_Ehdr</a> *tmp_ehdr;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;        <span class="keywordtype">int</span> rel = 0,status,num_of_loadable_segments = 0;</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        <a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> num_bytes = 0,va_offset;</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;        <span class="keywordtype">int</span> num_of_segments,fp = -1,ret = <a class="code" href="sw__semaphores_8h.html#aad472a601abac5aab18d6afddeab7de5">OTZ_OK</a>,mode = <a class="code" href="fat32_8h.html#ad52d51659a75e25d96fb04d22ff718cb">FILE_READ</a>;</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;        <a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> *flag = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,*base_va = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;        <a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> offset,leftover_size;       <a class="code" href="structElf32__Phdr.html">Elf32_Phdr</a> *phdr_table = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *tmp_phdr = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;        <span class="keywordtype">char</span> *leftover_data = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;        conf-&gt;<a class="code" href="structsa__config__t.html#aaf22a3f2509c5b4b1c7eeccc4be71a10">elf_flag</a> = -1;</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;        ret = init_map_loader(conf);</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;        <span class="keywordflow">if</span>(ret != 0)</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;        {</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;                <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;Mapping PA to VA failed\n&quot;</span>);</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;                ret = -1;</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;                <span class="keywordflow">goto</span> out;</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;        }</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;        fp = <a class="code" href="fat32_8c.html#a84769e634b08f5a3d70176e0bec32979">file_open</a>(conf-&gt;<a class="code" href="structsa__config__t.html#a6c77834580e13c7c41f8325317aca810">file_path</a>,mode);</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;        <span class="keywordflow">if</span>(fp == -1){</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;                <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;unable to open file\n&quot;</span>);</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;                ret =- 1;</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;                <span class="keywordflow">goto</span> out;</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;        }</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;        rel = validate_elf_header(fp,&amp;elf_header);</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;        tmp_ehdr = &amp;elf_header;</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;        <span class="keywordflow">if</span>(rel == 1){</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;                status = relocate_elf_loader(fp,tmp_ehdr,conf);</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;<span class="comment">/* We dont care about whatever be the status here, because we need to clean up </span></div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;<span class="comment">* the elf_loader task irrespective of the result */</span></div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;                ret = status;</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;                <span class="keywordflow">if</span>(status == -1 ||  status == 0)</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;                        <span class="keywordflow">goto</span> out;</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;        }</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;        <span class="keywordflow">if</span>(rel == -1 ){</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;                ret = -1;</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;                <span class="keywordflow">goto</span> out;</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;        }</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;        <span class="comment">/* Here we are dealing with a executable...right now the executable</span></div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;<span class="comment">         * support is not required.. */</span></div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        <span class="keywordflow">goto</span> out;</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;        conf-&gt;<a class="code" href="structsa__config__t.html#a9b45e143ad53f31f96d95d6445a85a96">entry_point</a> = elf_header.<a class="code" href="structElf32__Ehdr.html#ab8a982696048d807017919b7d0145482">e_entry</a>;</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;        num_of_loadable_segments = get_number_of_loadable_segments(fp,</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;                        &amp;elf_header,&amp;phdr_table);</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;        <span class="keywordflow">if</span>(num_of_loadable_segments == -1){</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;                ret =- 1;</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;                <span class="keywordflow">goto</span> out;</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;        }</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;        tmp_phdr = phdr_table;</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;<span class="comment">/* array of u32 entries whose total number equals number_of_loadable_segments */</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;        flag = <a class="code" href="sw__buddy_8h.html#a66652368e6d05f18bdc4be02b0c62694">sw_malloc</a>(num_of_loadable_segments * <span class="keyword">sizeof</span>(<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>) );</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;        <span class="keywordflow">if</span>(flag  == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>){</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;                <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;No memory available\n&quot;</span>);</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;                ret =- 1;</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;                <span class="keywordflow">goto</span> out;</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;        }</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;        <a class="code" href="sw__mem__functions_8h.html#a14af1b39b1154a36624740bad34b813f">sw_memset</a>(flag,0x0,num_of_loadable_segments * <span class="keyword">sizeof</span>(<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>));</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;        <span class="keywordflow">for</span>(num_of_segments = 0;num_of_segments &lt; elf_header.<a class="code" href="structElf32__Ehdr.html#a360898812db1655f8cb8258780d9df5b">e_phnum</a>;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;                        num_of_segments++){</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;                <span class="keywordflow">if</span>(tmp_phdr-&gt;p_type == <a class="code" href="elf_8h.html#a84d7768fd6c6ece599d297090900cf92">PT_LOAD</a>)</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;                {</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;<span class="comment">/* we need to check if the segment contains the .bss section </span></div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;<span class="comment"> *  in which p_filesz &lt; p_memsz */</span></div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;                        <span class="keywordflow">if</span>(tmp_phdr-&gt;p_filesz == tmp_phdr-&gt;p_memsz)</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;                        {</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;                                va_offset = tmp_phdr-&gt;p_vaddr;  </div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;                                offset = tmp_phdr-&gt;p_offset;                    </div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;                                <a class="code" href="fat32_8c.html#aca830bf635040373e76a89987ab6658e">file_seek</a>(fp,0,<a class="code" href="fat32_8h.html#ae2c4c68b8f9b63358f8c8f32b77ecb09">FILE_SEEK_SET</a>); </div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;                                <a class="code" href="fat32_8c.html#aca830bf635040373e76a89987ab6658e">file_seek</a>(fp,offset,<a class="code" href="fat32_8h.html#ae2c4c68b8f9b63358f8c8f32b77ecb09">FILE_SEEK_SET</a>);</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;                                num_bytes = 0;</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;                                num_bytes = <a class="code" href="fat32_8c.html#a273aa89ce2f3dc57b21dfbbe3c64267b">file_read</a>(fp,((<span class="keywordtype">char</span> *)base_va</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;                                                        + va_offset ),</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;                                                tmp_phdr-&gt;p_filesz);    </div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;                                <span class="keywordflow">if</span>(num_bytes != tmp_phdr-&gt;p_filesz){</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;                                        <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;Reading segment failed\n&quot;</span>);</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;                                        ret = -1;</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;                                        <span class="keywordflow">goto</span> out;</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;                                }</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;                        }</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tmp_phdr-&gt;p_filesz &lt; tmp_phdr-&gt;p_memsz){</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;                                va_offset = tmp_phdr-&gt;p_vaddr;</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;                                offset = tmp_phdr-&gt;p_offset; </div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;                                <a class="code" href="fat32_8c.html#aca830bf635040373e76a89987ab6658e">file_seek</a>(fp,0,<a class="code" href="fat32_8h.html#ae2c4c68b8f9b63358f8c8f32b77ecb09">FILE_SEEK_SET</a>); </div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;                                <a class="code" href="fat32_8c.html#aca830bf635040373e76a89987ab6658e">file_seek</a>(fp,offset,<a class="code" href="fat32_8h.html#ae2c4c68b8f9b63358f8c8f32b77ecb09">FILE_SEEK_SET</a>);</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;                                num_bytes = 0;</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;                                num_bytes = <a class="code" href="fat32_8c.html#a273aa89ce2f3dc57b21dfbbe3c64267b">file_read</a>(fp,((<span class="keywordtype">char</span> *)base_va +</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;                                                        va_offset),</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;                                                tmp_phdr-&gt;p_filesz);            </div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;                                <span class="keywordflow">if</span>(num_bytes != tmp_phdr-&gt;p_filesz){</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;                                        <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;Reading segment failed\n&quot;</span>);</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;                                        ret = -1;</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;                                        <span class="keywordflow">goto</span> out;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;                                }</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;                                leftover_size = (tmp_phdr-&gt;p_memsz - </div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;                                                tmp_phdr-&gt;p_filesz + 1);</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;                                leftover_data = (<span class="keywordtype">char</span> *)<a class="code" href="sw__buddy_8h.html#a66652368e6d05f18bdc4be02b0c62694">sw_malloc</a>(</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;                                                tmp_phdr-&gt;p_memsz -</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;                                                tmp_phdr-&gt;p_filesz+ 1);</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;                                <a class="code" href="sw__mem__functions_8h.html#a14af1b39b1154a36624740bad34b813f">sw_memset</a>(leftover_data,0x0,(tmp_phdr-&gt;p_memsz -</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;                                                        tmp_phdr-&gt;p_filesz + 1));</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;                                <a class="code" href="sw__mem__functions_8h.html#a51ad02aba462d7be9a03231afa56de27">sw_memcpy</a>(base_va,leftover_data,leftover_size); </div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;                                <a class="code" href="sw__mem__functions_8h.html#a8bf0e52640edb19377570fd04052d6c1">sw_malloc_free</a>(leftover_data);          </div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;                        }</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;                }</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;                tmp_phdr = ( <a class="code" href="structElf32__Phdr.html">Elf32_Phdr</a> *)((<span class="keywordtype">char</span> *)tmp_phdr + </div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;                                elf_header.<a class="code" href="structElf32__Ehdr.html#afa2289f96d86fcc568a3b1f40cc8953e">e_phentsize</a>);</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        }       </div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;        <span class="comment">/* TODO: </span></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;<span class="comment">           1) Also, Add support for dynamic linking (Not needed for now )</span></div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;out:</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;        <span class="comment">/* Free the allocated memory and resources here */</span> </div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;        <span class="keywordflow">if</span>(phdr_table){</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;                tmp_phdr = phdr_table;</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;                <span class="keywordflow">for</span>(num_of_segments = 0,num_of_loadable_segments = 0;</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;                                num_of_segments &lt; elf_header.<a class="code" href="structElf32__Ehdr.html#a360898812db1655f8cb8258780d9df5b">e_phnum</a>;</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;                                num_of_segments++){</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;                        <span class="keywordflow">if</span>(tmp_phdr-&gt;p_type == <a class="code" href="elf_8h.html#a84d7768fd6c6ece599d297090900cf92">PT_LOAD</a>){</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;                                <span class="keywordflow">if</span>(!flag[num_of_loadable_segments]){</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;                                        <a class="code" href="mem__mng_8h.html#a693354d2eff452e5a2c6786a7d965bf9">sw_vir_addr_free</a>(((<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>)base_va + </div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;                                                                tmp_phdr-&gt;p_vaddr),</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;                                                        tmp_phdr-&gt;p_memsz );</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;                                }</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;                                num_of_loadable_segments++;</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;                        }</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;                        tmp_phdr = ( <a class="code" href="structElf32__Phdr.html">Elf32_Phdr</a> *)((<span class="keywordtype">char</span> *)tmp_phdr + </div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;                                        elf_header.<a class="code" href="structElf32__Ehdr.html#afa2289f96d86fcc568a3b1f40cc8953e">e_phentsize</a>);</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;                }</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;                <a class="code" href="sw__mem__functions_8h.html#a8bf0e52640edb19377570fd04052d6c1">sw_malloc_free</a>(phdr_table);</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;        }</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;        <span class="keywordflow">if</span>(fp != -1){</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;                <a class="code" href="fat32_8c.html#a0ca3db9f9234948f42c95d5bec2820b0">file_close</a>(fp);</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;        }</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;        <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;}</div>
<div class="ttc" id="structElf32__Ehdr_html"><div class="ttname"><a href="structElf32__Ehdr.html">Elf32_Ehdr</a></div><div class="ttdef"><b>Definition:</b> <a href="elf_8h_source.html#l00069">elf.h:69</a></div></div>
<div class="ttc" id="elf_8h_html_a84d7768fd6c6ece599d297090900cf92"><div class="ttname"><a href="elf_8h.html#a84d7768fd6c6ece599d297090900cf92">PT_LOAD</a></div><div class="ttdeci">#define PT_LOAD</div><div class="ttdef"><b>Definition:</b> <a href="elf_8h_source.html#l00572">elf.h:572</a></div></div>
<div class="ttc" id="fat32_8c_html_aca830bf635040373e76a89987ab6658e"><div class="ttname"><a href="fat32_8c.html#aca830bf635040373e76a89987ab6658e">file_seek</a></div><div class="ttdeci">int file_seek(int fd, int offset, int whence)</div><div class="ttdoc">Function to seek the opened file pointer to the desired location so that subsequent read and write op...</div><div class="ttdef"><b>Definition:</b> <a href="fat32_8c_source.html#l00861">fat32.c:861</a></div></div>
<div class="ttc" id="fat32_8h_html_ae2c4c68b8f9b63358f8c8f32b77ecb09"><div class="ttname"><a href="fat32_8h.html#ae2c4c68b8f9b63358f8c8f32b77ecb09">FILE_SEEK_SET</a></div><div class="ttdeci">#define FILE_SEEK_SET</div><div class="ttdef"><b>Definition:</b> <a href="fat32_8h_source.html#l00099">fat32.h:99</a></div></div>
<div class="ttc" id="sw__semaphores_8h_html_aad472a601abac5aab18d6afddeab7de5"><div class="ttname"><a href="sw__semaphores_8h.html#aad472a601abac5aab18d6afddeab7de5">OTZ_OK</a></div><div class="ttdeci">#define OTZ_OK</div><div class="ttdef"><b>Definition:</b> <a href="sw__semaphores_8h_source.html#l00038">sw_semaphores.h:38</a></div></div>
<div class="ttc" id="fat32_8c_html_a84769e634b08f5a3d70176e0bec32979"><div class="ttname"><a href="fat32_8c.html#a84769e634b08f5a3d70176e0bec32979">file_open</a></div><div class="ttdeci">int file_open(const char *file_path, int flags)</div><div class="ttdoc">Function to open a specific file mentioned in the path based on the incoming modes. </div><div class="ttdef"><b>Definition:</b> <a href="fat32_8c_source.html#l00147">fat32.c:147</a></div></div>
<div class="ttc" id="structElf32__Ehdr_html_afa2289f96d86fcc568a3b1f40cc8953e"><div class="ttname"><a href="structElf32__Ehdr.html#afa2289f96d86fcc568a3b1f40cc8953e">Elf32_Ehdr::e_phentsize</a></div><div class="ttdeci">Elf32_Half e_phentsize</div><div class="ttdef"><b>Definition:</b> <a href="elf_8h_source.html#l00080">elf.h:80</a></div></div>
<div class="ttc" id="sw__buddy_8h_html_a66652368e6d05f18bdc4be02b0c62694"><div class="ttname"><a href="sw__buddy_8h.html#a66652368e6d05f18bdc4be02b0c62694">sw_malloc</a></div><div class="ttdeci">void * sw_malloc(u32 size)</div><div class="ttdoc">Gets the task id and allocates memory in the heap memory corresponding to the task. </div><div class="ttdef"><b>Definition:</b> <a href="sw__buddy_8c_source.html#l00688">sw_buddy.c:688</a></div></div>
<div class="ttc" id="fat32_8h_html_ad52d51659a75e25d96fb04d22ff718cb"><div class="ttname"><a href="fat32_8h.html#ad52d51659a75e25d96fb04d22ff718cb">FILE_READ</a></div><div class="ttdeci">#define FILE_READ</div><div class="ttdef"><b>Definition:</b> <a href="fat32_8h_source.html#l00083">fat32.h:83</a></div></div>
<div class="ttc" id="fat32_8c_html_a0ca3db9f9234948f42c95d5bec2820b0"><div class="ttname"><a href="fat32_8c.html#a0ca3db9f9234948f42c95d5bec2820b0">file_close</a></div><div class="ttdeci">int file_close(int fd)</div><div class="ttdoc">Close the opened file based on the file descriptor and free the file structure pointer. </div><div class="ttdef"><b>Definition:</b> <a href="fat32_8c_source.html#l00651">fat32.c:651</a></div></div>
<div class="ttc" id="sw__mem__functions_8h_html_a51ad02aba462d7be9a03231afa56de27"><div class="ttname"><a href="sw__mem__functions_8h.html#a51ad02aba462d7be9a03231afa56de27">sw_memcpy</a></div><div class="ttdeci">void * sw_memcpy(void *dst, const void *src, u32 count)</div><div class="ttdoc">This version of memcpy assumes disjoint ptrs src, dst. </div><div class="ttdef"><b>Definition:</b> <a href="sw__mem__functions_8c_source.html#l00100">sw_mem_functions.c:100</a></div></div>
<div class="ttc" id="sw__mem__functions_8h_html_a14af1b39b1154a36624740bad34b813f"><div class="ttname"><a href="sw__mem__functions_8h.html#a14af1b39b1154a36624740bad34b813f">sw_memset</a></div><div class="ttdeci">void * sw_memset(void *dest, u32 c, u32 count)</div><div class="ttdoc">memory set </div><div class="ttdef"><b>Definition:</b> <a href="sw__mem__functions_8c_source.html#l00074">sw_mem_functions.c:74</a></div></div>
<div class="ttc" id="structElf32__Ehdr_html_ab8a982696048d807017919b7d0145482"><div class="ttname"><a href="structElf32__Ehdr.html#ab8a982696048d807017919b7d0145482">Elf32_Ehdr::e_entry</a></div><div class="ttdeci">Elf32_Addr e_entry</div><div class="ttdef"><b>Definition:</b> <a href="elf_8h_source.html#l00075">elf.h:75</a></div></div>
<div class="ttc" id="sw__types_8h_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="sw__types_8h_source.html#l00039">sw_types.h:39</a></div></div>
<div class="ttc" id="sw__debug_8h_html_a501cc8c07cf94dc1a6269c0d3ba5a234"><div class="ttname"><a href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a></div><div class="ttdeci">u32 sw_printf(const char *fmt,...)</div><div class="ttdoc">Print Function. </div><div class="ttdef"><b>Definition:</b> <a href="sw__debug_8c_source.html#l00046">sw_debug.c:46</a></div></div>
<div class="ttc" id="structsa__config__t_html_a6c77834580e13c7c41f8325317aca810"><div class="ttname"><a href="structsa__config__t.html#a6c77834580e13c7c41f8325317aca810">sa_config_t::file_path</a></div><div class="ttdeci">char file_path[255]</div><div class="ttdef"><b>Definition:</b> <a href="task_8h_source.html#l00054">task.h:54</a></div></div>
<div class="ttc" id="sw__mem__functions_8h_html_a8bf0e52640edb19377570fd04052d6c1"><div class="ttname"><a href="sw__mem__functions_8h.html#a8bf0e52640edb19377570fd04052d6c1">sw_malloc_free</a></div><div class="ttdeci">void sw_malloc_free(void *ptr)</div><div class="ttdoc">Frees the memory allocated by passing the address ptr. </div><div class="ttdef"><b>Definition:</b> <a href="sw__heap_8c_source.html#l00035">sw_heap.c:35</a></div></div>
<div class="ttc" id="structsa__config__t_html_aaf22a3f2509c5b4b1c7eeccc4be71a10"><div class="ttname"><a href="structsa__config__t.html#aaf22a3f2509c5b4b1c7eeccc4be71a10">sa_config_t::elf_flag</a></div><div class="ttdeci">u32 elf_flag</div><div class="ttdef"><b>Definition:</b> <a href="task_8h_source.html#l00052">task.h:52</a></div></div>
<div class="ttc" id="structElf32__Ehdr_html_a360898812db1655f8cb8258780d9df5b"><div class="ttname"><a href="structElf32__Ehdr.html#a360898812db1655f8cb8258780d9df5b">Elf32_Ehdr::e_phnum</a></div><div class="ttdeci">Elf32_Half e_phnum</div><div class="ttdef"><b>Definition:</b> <a href="elf_8h_source.html#l00081">elf.h:81</a></div></div>
<div class="ttc" id="sw__types_8h_html_a10e94b422ef0c20dcdec20d31a1f5049"><div class="ttname"><a href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a></div><div class="ttdeci">unsigned int u32</div><div class="ttdef"><b>Definition:</b> <a href="sw__types_8h_source.html#l00061">sw_types.h:61</a></div></div>
<div class="ttc" id="mem__mng_8h_html_a693354d2eff452e5a2c6786a7d965bf9"><div class="ttname"><a href="mem__mng_8h.html#a693354d2eff452e5a2c6786a7d965bf9">sw_vir_addr_free</a></div><div class="ttdeci">int sw_vir_addr_free(u32 vir_addr, int size)</div><div class="ttdoc">Reserves the required pages in the bitmap. </div><div class="ttdef"><b>Definition:</b> <a href="mem__mng_8c_source.html#l00454">mem_mng.c:454</a></div></div>
<div class="ttc" id="structElf32__Phdr_html"><div class="ttname"><a href="structElf32__Phdr.html">Elf32_Phdr</a></div><div class="ttdef"><b>Definition:</b> <a href="elf_8h_source.html#l00539">elf.h:539</a></div></div>
<div class="ttc" id="structsa__config__t_html_a9b45e143ad53f31f96d95d6445a85a96"><div class="ttname"><a href="structsa__config__t.html#a9b45e143ad53f31f96d95d6445a85a96">sa_config_t::entry_point</a></div><div class="ttdeci">u32 entry_point</div><div class="ttdef"><b>Definition:</b> <a href="task_8h_source.html#l00050">task.h:50</a></div></div>
<div class="ttc" id="fat32_8c_html_a273aa89ce2f3dc57b21dfbbe3c64267b"><div class="ttname"><a href="fat32_8c.html#a273aa89ce2f3dc57b21dfbbe3c64267b">file_read</a></div><div class="ttdeci">int file_read(int fd, char *buffer, int bytes_to_read)</div><div class="ttdoc">Function to read the contents of a file. </div><div class="ttdef"><b>Definition:</b> <a href="fat32_8c_source.html#l00502">fat32.c:502</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ab6814f634bead0f3ecd360e88acd9df8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int elf_loader_cleanup </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>clean up function to remove the mappings </p>
<p>cleans up the reserved secure memory region</p>
<dl class="section return"><dt>Returns</dt><dd>0 on success , -1 on failure </dd></dl>

<p>Definition at line <a class="el" href="elf__loader_8c_source.html#l00082">82</a> of file <a class="el" href="elf__loader_8c_source.html">elf_loader.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;{</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        <span class="keywordtype">int</span> status = 0;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        <span class="comment">/* 0 indicates that the mapping is successful, so do the cleanup */</span> </div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        status = <a class="code" href="page__table_8h.html#a052242469f722badd350a69d03e9e88a">unmap_secure_memory</a>((<a class="code" href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a>)<a class="code" href="sw__board_8h.html#aed82c0b91868582b0328eff0c59f9db8">BASE_LOAD_ADDRESS</a>, </div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;                        <a class="code" href="mem__mng_8h.html#af736426da3c7639cf81900258bdd8a05">SECTION_SIZE</a>);</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        <span class="keywordflow">if</span> (status == -1){</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;                <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;Unable to unmap secure memory of elf loader\n&quot;</span>);</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        }</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        <span class="keywordflow">return</span> status;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;}</div>
<div class="ttc" id="sw__types_8h_html_a8a8f44dda695920b3f7210c1c28ff23b"><div class="ttname"><a href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a></div><div class="ttdeci">u32 va_t</div><div class="ttdef"><b>Definition:</b> <a href="sw__types_8h_source.html#l00084">sw_types.h:84</a></div></div>
<div class="ttc" id="page__table_8h_html_a052242469f722badd350a69d03e9e88a"><div class="ttname"><a href="page__table_8h.html#a052242469f722badd350a69d03e9e88a">unmap_secure_memory</a></div><div class="ttdeci">int unmap_secure_memory(va_t va, u32 size)</div><div class="ttdoc">Unmap a range of secure memory area. </div><div class="ttdef"><b>Definition:</b> <a href="page__table_8c_source.html#l00409">page_table.c:409</a></div></div>
<div class="ttc" id="sw__board_8h_html_aed82c0b91868582b0328eff0c59f9db8"><div class="ttname"><a href="sw__board_8h.html#aed82c0b91868582b0328eff0c59f9db8">BASE_LOAD_ADDRESS</a></div><div class="ttdeci">#define BASE_LOAD_ADDRESS</div><div class="ttdef"><b>Definition:</b> <a href="sw__board_8h_source.html#l00045">sw_board.h:45</a></div></div>
<div class="ttc" id="sw__debug_8h_html_a501cc8c07cf94dc1a6269c0d3ba5a234"><div class="ttname"><a href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a></div><div class="ttdeci">u32 sw_printf(const char *fmt,...)</div><div class="ttdoc">Print Function. </div><div class="ttdef"><b>Definition:</b> <a href="sw__debug_8c_source.html#l00046">sw_debug.c:46</a></div></div>
<div class="ttc" id="mem__mng_8h_html_af736426da3c7639cf81900258bdd8a05"><div class="ttname"><a href="mem__mng_8h.html#af736426da3c7639cf81900258bdd8a05">SECTION_SIZE</a></div><div class="ttdeci">#define SECTION_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="mem__mng_8h_source.html#l00035">mem_mng.h:35</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat May 3 2014 13:35:44 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
